# FR101 Mobile Tutor — System Plan (Single Source of Truth)

## 0) Product Goal
- Target: 22-student class (FR101) — mobile-first (phone > tablet > desktop)
- Experience: Anki-speed, minimal friction, “tokluk” hissi, no gamification
- Content: teacher notes -> flashcards + mini quizzes + audio
- Auth: Supabase magic link (email)
- Motivation (no anxiety): weekly personal summary + anonymous class dashboard (aggregate only)

## 1) Non-negotiables
- Audio must be reliable on mobile (play() rejection handled)
- Offline/PWA must work (campus/metro)
- Local-first UX (UI never blocked by network)
- No leaderboard, no public user identities

## 2) Current Stack
- Next.js (App Router) + TypeScript + Tailwind
- Supabase (Postgres + Storage + Auth) via supabase-js
- Curriculum in JSON, notes in Markdown

## 3) Roadmap (priority order)
### Sprint A — Flawless Core
A1. Audio reliability fix (unlock + single <audio> ref + debug mode)
A2. PWA + Offline caching (JSON + audio + offline fallback)
A3. Local-first progress (IndexedDB queue) + background sync to Supabase
A4. Mobile UX polish (swipe thresholds, touch targets, tablet orientations)

### Sprint B — Placement + Learnability
B1. Placement-lite test (12 Q max; recognition + audio + confusables)
B2. Scaffolding (1-minute onboarding, then optional)

### Sprint C — Feedback + Shadow Data
C1. In-app feedback: "Hatalı" / "Öneri"
C2. Shadow data event logging (anonymous aggregate dashboard)
C3. /class dashboard (aggregate metrics) + /me weekly summary

## 4) Prompts to run (Agents)
### Prompt 1 — Audio Flawless
- Implement single <audio> element (ref)
- Tap-to-enable audio unlock flow
- play() rejection handling + clear user hint
- Debug query param: ?debugAudio=1 shows src/canPlayType/last error

### Prompt 2 — PWA + Offline
- Add manifest + icons + standalone mode
- Service worker caching strategy:
  - Curriculum JSON: stale-while-revalidate
  - Audio: cache-first with size limits
- Offline fallback screen

### Prompt 3 — Local-first + Sync
- Store progress + pending events in IndexedDB
- UI reads from local first
- Online event triggers batch sync to Supabase
- Retry strategy

### Prompt 4 — Placement-lite + Scaffolding
Routes:
- /test, /test/run, /test/result
Question types:
- recognition, audio recognition, confusable pairs
Result:
- strengths/weaknesses by topic + suggested starting point
Add 1-minute onboarding (optional)

### Prompt 5 — Feedback + Shadow Data + Dashboards
- feedback table + UI submit
- events table + logging (know/dont_know/audio_played/duration/quiz_done)
- /class aggregate dashboard (7-day totals, top topics, hardest topics/cards)
- /me personal weekly summary (only user can see)

### Prompt 6 — Curriculum Grouping Blocks
- Curriculum overview groups units under:
  { 101 }
  { 102 } (locked if not available)
- Mobile-friendly collapsible blocks

## 5) What James must provide (inputs)
### Weekly notes template (copy for each week)
- Week: Week 01
- Topics (5–10 bullets):
- Example sentences (5–10):
- Common confusions / traps:
- Teacher’s top 3 emphasized points:

### Topic list
- Greetings, Numbers, Days/Months, Pronunciation, Grammar-notes, ...

### Pilot testers / devices
- iPhone + Android + Tablet (portrait + landscape)

### Class identifier
- Example: FR101-2026-BOUN

## 6) MCP / Tooling status (update this every time you switch IDE/model)
### Commands
- claude mcp list
- claude --debug mcp list
- cat ~/.claude.json

### Expected
- supabase MCP: (working or failing?) -> write status here
- posthog MCP: (auth status)
- notion MCP: (auth status)

## 7) Definition of Done (for "flawless")
- Mobile audio works 100% after first tap (no silent failures)
- App loads fast on 4G and can run offline for last-used content
- Swipes are intentional (no accidental triggers on scroll)
- Placement test gives correct topic suggestions
- Class dashboard shows aggregate metrics with no identities